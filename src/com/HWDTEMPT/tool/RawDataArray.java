package com.HWDTEMPT.tool;

import com.HWDTEMPT.hwdtempt.bleactivty;
import com.HWDTEMPT.model.StaticValue;

import java.util.ArrayList;
import java.util.List;

public class RawDataArray
{
    private static float egoRawData;
    private static float array[];
    public static int rawData;
    public static Object syncRoot;
    private static float scaleRate=18;
    public static int arrayLength=4096;//6144
    private static int BUFFER_SIZE_HPF = 257;
    private static int BUFFER_SIZE_LPF = 131;

    private static float[] eegBuffer_hpf;
    private static float[] eegBuffer_lpf;
    private static double[] filt_coeff_hpf;
    private static double[] filt_coeff_lpf;
    private static float filtered;
    private static List<Float>eightping=new ArrayList<Float>();
    private static float[] tempeegBuffer_hpf;
    private static float[] tempeegBuffer_lpf;
    public static int gintint;
    
    static
    {
      syncRoot = new Object();
      eegBuffer_lpf = new float[BUFFER_SIZE_LPF];
      tempeegBuffer_lpf = new float[BUFFER_SIZE_LPF];
      eegBuffer_hpf = new float[BUFFER_SIZE_HPF];
      tempeegBuffer_hpf = new float[BUFFER_SIZE_HPF];
      array = new float[arrayLength];
      filt_coeff_lpf = new double[] { -0.000168667856880048D, -0.000329491866181245D, -0.000570063232930836D, -0.000826612236151652D, -0.00102118556820869D, -0.00104971174571026D, -0.000801872594340795D, -0.000190414912607982D, 0.000815951956596345D, 0.00216436484902995D, 0.00370511679981089D, 0.00520177157607237D, 0.00636721899187339D, 0.00692217086219052D, 0.00666504229086917D, 0.00553570513970002D, 0.0036561554436569D, 0.00133045289849665D, -0.0010013913950266D, -0.00285231859315746D, -0.00380222871588756D, -0.00361049462064574D, -0.00229679878806854D, -0.00016335705535567D, 0.0022543931161225D, 0.00430512184469986D, 0.00538302387765288D, 0.0050948619038306D, 0.00338731613829165D, 0.000595295172245412D, -0.0026114705135867D, -0.00537969180920409D, -0.00689102492163201D, -0.00659400949694251D, -0.00438666736300679D, -0.00069322820676908D, 0.0035980779193214D, 0.00733374168470104D, 0.00939005097377244D, 0.00899234291229742D, 0.00597232020008678D, 0.000884686973420358D, -0.00506484158461425D, -0.0102813959951347D, -0.0131816190779121D, -0.012638573409868D, -0.0083537432243722D, -0.0010463658426189D, 0.0076126476108411D, 0.015334183292998D, 0.019754312683242D, 0.0190691382092526D, 0.0126064198256393D, 0.0011805929005385D, -0.0128825259120617D, -0.0260922278266422D, -0.0344634703045011D, -0.0343808963219089D, -0.0234687806909481D, -0.0012644035187221D, 0.030474715929272D, 0.067924021713415D, 0.105798489688712D, 0.138301661077912D, 0.160224410855649D, 0.167961155238185D, 0.160224410855649D, 0.138301661077912D, 0.105798489688712D, 0.067924021713415D, 0.030474715929272D, -0.0012644035187221D, -0.0234687806909481D, -0.0343808963219089D, -0.0344634703045011D, -0.0260922278266422D, -0.0128825259120617D, 0.0011805929005385D, 0.0126064198256393D, 0.0190691382092526D, 0.019754312683242D, 0.015334183292998D, 0.0076126476108411D, -0.0010463658426189D, -0.0083537432243722D, -0.012638573409868D, -0.0131816190779121D, -0.0102813959951347D, -0.00506484158461425D, 0.000884686973420358D, 0.00597232020008678D, 0.00899234291229742D, 0.00939005097377244D, 0.00733374168470104D, 0.0035980779193214D, -0.00069322820676908D, -0.00438666736300679D, -0.00659400949694251D, -0.00689102492163201D, -0.00537969180920409D, -0.0026114705135867D, 0.000595295172245412D, 0.00338731613829165D, 0.0050948619038306D, 0.00538302387765288D, 0.00430512184469986D, 0.0022543931161225D, -0.00016335705535567D, -0.00229679878806854D, -0.00361049462064574D, -0.00380222871588756D, -0.00285231859315746D, -0.0010013913950266D, 0.00133045289849665D, 0.0036561554436569D, 0.00553570513970002D, 0.00666504229086917D, 0.00692217086219052D, 0.00636721899187339D, 0.00520177157607237D, 0.00370511679981089D, 0.00216436484902995D, 0.000815951956596345D, -0.000190414912607982D, -0.000801872594340795D, -0.00104971174571026D, -0.00102118556820869D, -0.000826612236151652D, -0.000570063232930836D, -0.000329491866181245D, -0.000168667856880048D };
      filt_coeff_hpf = new double[] { 0.024081553928668D, 0.0009407158975986921D, 0.00095643797019856D, 0.000969697411452199D, 0.00098146855754746D, 0.0009903731234101501D, 0.0009980453432905079D, 0.00100268670736766D, 0.0010059882011237D, 0.0010061721022123D, 0.00100502904982186D, 0.00100065530537616D, 0.0009948449917892531D, 0.0009855681172729D, 0.000974759111683958D, 0.000960406141450635D, 0.000944617219923473D, 0.000925316284579598D, 0.000904056377730812D, 0.000878031076317816D, 0.0008523646306748931D, 0.00082073414158823D, 0.00078737089428539D, 0.000750166173221365D, 0.00071111789787638D, 0.000666784641103747D, 0.000620928846705191D, 0.00056959078035575D, 0.00051729620911614D, 0.000459227877785015D, 0.00040084517502388D, 0.000336300741790042D, 0.000272561315287353D, 0.00020225857268973D, 0.000134512503466984D, 5.89249946345925E-005D, -1.20066664151013E-005D, -9.544040003070321E-005D, -0.000171944683771412D, -0.000290310451521375D, -0.000371282599646329D, -0.000452216060042622D, -0.000561446979520252D, -0.000656668952699643D, -0.000765592161135481D, -0.00086952609872032D, -0.000983158115535796D, -0.001094142633567D, -0.0012129523393437D, -0.00133034468479231D, -0.00145448666649568D, -0.00157784742816918D, -0.0017070702070429D, -0.00183582932898464D, -0.0019698229703147D, -0.0021037594826054D, -0.00224256100571596D, -0.00238157936428058D, -0.00252355494007084D, -0.00266782132560331D, -0.00281525361822139D, -0.00296157940918263D, -0.00311319492784397D, -0.00326476953978251D, -0.00341959839388502D, -0.00357414107030067D, -0.00373163176685477D, -0.00388890484967938D, -0.00404868980405557D, -0.00420804768477047D, -0.00436928973880953D, -0.00453000935081191D, -0.00469232334515239D, -0.00485459722634887D, -0.00501848163395221D, -0.00518296598466496D, -0.00534825870102164D, -0.00551367239946968D, -0.0056736504539968D, -0.00583360450713192D, -0.00600481134200426D, -0.00616243992601246D, -0.00632676244108102D, -0.00648634040190837D, -0.00664813846220241D, -0.00680598282166261D, -0.00696522085580777D, -0.00712075629715319D, -0.00727699561591129D, -0.00742942902665456D, -0.00758198103611988D, -0.00773067849034757D, -0.00787907548502928D, -0.0080235902032407D, -0.00816723470663195D, -0.00830689473773286D, -0.008444895387661361D, -0.008580232920244761D, -0.00871282911154019D, -0.008839915413335951D, -0.00896897779490221D, -0.009090761213769951D, -0.00921091543711421D, -0.00932572242967724D, -0.00943925031073509D, -0.00954712158160808D, -0.009653070230100719D, -0.009752973771844239D, -0.009850676907937291D, -0.00994238332527418D, -0.010031952339641D, -0.010115547265758D, -0.010196757661607D, -0.0102714992623429D, -0.0103432511790072D, -0.0104080133584448D, -0.010469846206667D, -0.010526423253409D, -0.0105824561216737D, -0.010625465647753D, -0.010669824007569D, -0.010707131799699D, -0.01074018757284D, -0.0107673615340736D, -0.01079083755503D, -0.0108080232455876D, -0.010821408932634D, -0.01082836134236D, 0.989168433849746D, -0.01082836134236D, -0.010821408932634D, -0.0108080232455876D, -0.01079083755503D, -0.0107673615340736D, -0.01074018757284D, -0.010707131799699D, -0.010669824007569D, -0.010625465647753D, -0.0105824561216737D, -0.010526423253409D, -0.010469846206667D, -0.0104080133584448D, -0.0103432511790072D, -0.0102714992623429D, -0.010196757661607D, -0.010115547265758D, -0.010031952339641D, -0.00994238332527418D, -0.009850676907937291D, -0.009752973771844239D, -0.009653070230100719D, -0.00954712158160808D, -0.00943925031073509D, -0.00932572242967724D, -0.00921091543711421D, -0.009090761213769951D, -0.00896897779490221D, -0.008839915413335951D, -0.00871282911154019D, -0.008580232920244761D, -0.008444895387661361D, -0.00830689473773286D, -0.00816723470663195D, -0.0080235902032407D, -0.00787907548502928D, -0.00773067849034757D, -0.00758198103611988D, -0.00742942902665456D, -0.00727699561591129D, -0.00712075629715319D, -0.00696522085580777D, -0.00680598282166261D, -0.00664813846220241D, -0.00648634040190837D, -0.00632676244108102D, -0.00616243992601246D, -0.00600481134200426D, -0.00583360450713192D, -0.0056736504539968D, -0.00551367239946968D, -0.00534825870102164D, -0.00518296598466496D, -0.00501848163395221D, -0.00485459722634887D, -0.00469232334515239D, -0.00453000935081191D, -0.00436928973880953D, -0.00420804768477047D, -0.00404868980405557D, -0.00388890484967938D, -0.00373163176685477D, -0.00357414107030067D, -0.00341959839388502D, -0.00326476953978251D, -0.00311319492784397D, -0.00296157940918263D, -0.00281525361822139D, -0.00266782132560331D, -0.00252355494007084D, -0.00238157936428058D, -0.00224256100571596D, -0.0021037594826054D, -0.0019698229703147D, -0.00183582932898464D, -0.0017070702070429D, -0.00157784742816918D, -0.00145448666649568D, -0.00133034468479231D, -0.0012129523393437D, -0.001094142633567D, -0.000983158115535796D, -0.00086952609872032D, -0.000765592161135481D, -0.000656668952699643D, -0.000561446979520252D, -0.000452216060042622D, -0.000371282599646329D, -0.000290310451521375D, -0.000171944683771412D, -9.544040003070321E-005D, -1.20066664151013E-005D, 5.89249946345925E-005D, 0.000134512503466984D, 0.00020225857268973D, 0.000272561315287353D, 0.000336300741790042D, 0.00040084517502388D, 0.000459227877785015D, 0.00051729620911614D, 0.00056959078035575D, 0.000620928846705191D, 0.000666784641103747D, 0.00071111789787638D, 0.000750166173221365D, 0.00078737089428539D, 0.00082073414158823D, 0.0008523646306748931D, 0.000878031076317816D, 0.000904056377730812D, 0.000925316284579598D, 0.000944617219923473D, 0.000960406141450635D, 0.000974759111683958D, 0.0009855681172729D, 0.0009948449917892531D, 0.00100065530537616D, 0.00100502904982186D, 0.0010061721022123D, 0.0010059882011237D, 0.00100268670736766D, 0.0009980453432905079D, 0.0009903731234101501D, 0.00098146855754746D, 0.000969697411452199D, 0.00095643797019856D, 0.0009407158975986921D, 0.024081553928668D };


    }

  public static void initArray()
  {
      float f1 = 4.0F *StaticValue.surfaceviewWidth / arrayLength;
      float f2 = 0;
      array[0]=0;
      array[1]=0;
      int i=2;
      while(i<arrayLength-4)
      {
          f2=f2+f1;
          array[i]=f2;
          array[i+2]=f2;
          array[i+1]=0;
          array[i+3]=0;
          i=i+4;
      }
      
      array[arrayLength-2]=f2+f1;
      array[arrayLength-1]=0;
  }


    
    public static void generateRawDataPosizationArray()
    {
        int i=1;
        
        while(i<arrayLength-4)
        {
            array[i]= array[i+4];
            i=i+2;
        }
        
        array[arrayLength-3]= array[arrayLength-1];
        

        egoRawData = StaticValue.surfaceviewHeight/2 -Float.valueOf(rawData)/scaleRate;
        
        System.arraycopy(eegBuffer_lpf, 1, tempeegBuffer_lpf, 0, -1 + BUFFER_SIZE_LPF);
        tempeegBuffer_lpf[(-1 + BUFFER_SIZE_LPF)] = egoRawData;
        System.arraycopy(tempeegBuffer_lpf, 0, eegBuffer_lpf, 0, BUFFER_SIZE_LPF);

        filtered = applyFilter_lpf(eegBuffer_lpf);
        System.arraycopy(eegBuffer_hpf, 1, tempeegBuffer_hpf, 0, -1 + BUFFER_SIZE_HPF);
        tempeegBuffer_hpf[(-1 + BUFFER_SIZE_HPF)] = filtered;
        System.arraycopy(tempeegBuffer_hpf, 0, eegBuffer_hpf, 0, BUFFER_SIZE_HPF);
        filtered = applyFilter_hpf(eegBuffer_hpf);
        
        if(eightping.size()<StaticValue.Fs/50)
        {
            eightping.add(filtered);
        }else{
            eightping.remove(0);
            eightping.add(filtered);
            float sum=0;
            for(int kk=0;kk<eightping.size();kk++)
            {
               sum+=eightping.get(kk);
            }
            filtered=sum/(StaticValue.Fs/50);     
        }
        
     if (bleactivty.fenbianlvda) {
         array[arrayLength-1]=(float) (filtered*gintint/18+StaticValue.surfaceviewHeight/3.2); 
    }else if(bleactivty.fenbianlvxiao) {
        array[arrayLength-1]=(float) (filtered*gintint/18+StaticValue.surfaceviewHeight/2.6);   //bmd101值为5
    }else if(bleactivty.fenbianlvxiao2) {
        array[arrayLength-1]=(float) (filtered*gintint/18+StaticValue.surfaceviewHeight/2.0);   //bmd101值为5
    }
      
        
     //  array[arrayLength-1]=(float)(egoRawData*gain/25+StaticValue.surfaceviewHeight/4.9);//16.12.18 同时关掉滤波器和增加增益功能
        //16.12.6 加大动态显示增益
        //16.12.10 动态增益参数修改
    }
    
    
    
    
    private static float applyFilter_hpf(float[] paramArrayOfFloat)
    {
      int i = paramArrayOfFloat.length;
      float f = 0.0F;
      for (int j = 0; ; j++)
      {
        if (j >= i)
          return f;
        f = (float)(f + paramArrayOfFloat[j] * filt_coeff_hpf[j]);
      }
    }

    private static float applyFilter_lpf(float[] paramArrayOfFloat)
    {
      int i = paramArrayOfFloat.length;
      float f = 0.0F;
      for (int j = 0; ; j++)
      {
        if (j >= i)
          return f;
        f = (float)(f + paramArrayOfFloat[j] * filt_coeff_lpf[j]);
      }
    }


      public static float[] getRawDataPosizationArray() {
          // TODO Auto-generated method stub
          return array;
      
      }
    
    public static int getint(int gint){
         gintint = gint;
        return gintint;
    }
    
}
